apply plugin: 'java'

task wrapper(type: Wrapper) {
  gradleVersion = '2.4'
}

sourceSets {
  main {
    java {
      srcDir 'src'
      exclude 'Encoder_GUI.java'
    }
    resources { srcDir 'resources' }
  }
}

jar {
  manifest {
    from 'resources/META-INF/MANIFEST.MF'
  }
}

task makeOutputDumps
fileTree('test/resources/') {
  include '*.ducky'
}.visit { f ->
  if(!f.isDirectory()) {
    def t = task("makeOutputDump-${f.name}", type: JavaExec) {
      def outputFile = file("test/outputs/${f.name.replace('.ducky', '.bin')}")
      outputFile.parentFile.mkdirs()

      classpath sourceSets.main.runtimeClasspath
      main 'Encoder'
      args '-i', f.file.path
      args '-o', outputFile.path
    }
    makeOutputDumps.dependsOn t
  }
}
